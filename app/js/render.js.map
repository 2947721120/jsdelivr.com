{"version":3,"file":"render.js","sources":["../.gobble-build/13-include/1/js/render.js"],"sourcesContent":["import logger from './logger';\nimport search from './search';\n\nlet appLog = logger('app');\nconst PROJECTS_PATTERN = /^\\/projects\\/([^/]+)\\/?$/i;\n\nexport default function (req, res) {\n\tlet path = req.path;\n\tlet renderOptions = { wrapper: 'app.html', el: 'page', data: {} };\n\tlet renderCallback = (error, html) => {\n\t\tif (error) {\n\t\t\t// Don't log \"Failed to lookup view\" errors.\n\t\t\tif (!error.message || error.message.indexOf('Failed to lookup view') === -1) {\n\t\t\t\tappLog.err(error);\n\t\t\t}\n\n\t\t\treturn res.sendStatus(404);\n\t\t}\n\n\t\tres.send(html);\n\t};\n\n\tif (path === '/') {\n\t\treturn search(req.query.query || '', req.query.page).then((projects) => {\n\t\t\trenderOptions.data.projects = projects;\n\t\t\tres.render('components/index.html', renderOptions, renderCallback);\n\t\t}).catch((error) => {\n\t\t\tappLog.err(error);\n\t\t\tres.sendStatus(500);\n\t\t});\n\t}\n\n\tif (PROJECTS_PATTERN.test(path)) {\n\t\treturn search(`name: ${PROJECTS_PATTERN.exec(path)[1]}`, 0).then((projects) => {\n\t\t\trenderOptions.data.project = projects[0];\n\t\t\trenderOptions.data.name = projects[0].name;\n\t\t\tres.render('components/projects.html', renderOptions, renderCallback);\n\t\t}).catch((error) => {\n\t\t\tappLog.err(error);\n\t\t\tres.sendStatus(500);\n\t\t});\n\t}\n\n\tres.render(`components${path}.html`, renderOptions, renderCallback);\n}\n"],"names":[],"mappings":";;;;;;;;sBAAmB,UAAU;;;;sBACV,UAAU;;;;AAE7B,IAAI,MAAM,GAAG,yBAAO,KAAK,CAAC,CAAC;AAC3B,IAAM,gBAAgB,GAAG,2BAA2B,CAAC;;qBAEtC,UAAU,GAAG,EAAE,GAAG,EAAE;AAClC,KAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;AACpB,KAAI,aAAa,GAAG,EAAE,OAAO,EAAE,UAAU,EAAE,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC;AAClE,KAAI,cAAc,GAAG,SAAjB,cAAc,CAAI,KAAK,EAAE,IAAI,EAAK;AACrC,MAAI,KAAK,EAAE;;AAEV,OAAI,CAAC,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,uBAAuB,CAAC,KAAK,CAAC,CAAC,EAAE;AAC5E,UAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAClB;;AAED,UAAO,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;GAC3B;;AAED,KAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;EACf,CAAC;;AAEF,KAAI,IAAI,KAAK,GAAG,EAAE;AACjB,SAAO,yBAAO,GAAG,CAAC,KAAK,CAAC,KAAK,IAAI,EAAE,EAAE,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAC,QAAQ,EAAK;AACvE,gBAAa,CAAC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;AACvC,MAAG,CAAC,MAAM,CAAC,uBAAuB,EAAE,aAAa,EAAE,cAAc,CAAC,CAAC;GACnE,CAAC,SAAM,CAAC,UAAC,KAAK,EAAK;AACnB,SAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AAClB,MAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;GACpB,CAAC,CAAC;EACH;;AAED,KAAI,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;AAChC,SAAO,oCAAgB,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAI,CAAC,CAAC,CAAC,IAAI,CAAC,UAAC,QAAQ,EAAK;AAC9E,gBAAa,CAAC,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;AACzC,gBAAa,CAAC,IAAI,CAAC,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;AAC3C,MAAG,CAAC,MAAM,CAAC,0BAA0B,EAAE,aAAa,EAAE,cAAc,CAAC,CAAC;GACtE,CAAC,SAAM,CAAC,UAAC,KAAK,EAAK;AACnB,SAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AAClB,MAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;GACpB,CAAC,CAAC;EACH;;AAED,IAAG,CAAC,MAAM,gBAAc,IAAI,YAAS,aAAa,EAAE,cAAc,CAAC,CAAC;CACpE"}