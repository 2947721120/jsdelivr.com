{"version":3,"file":"render.js","sources":["../.gobble-build/13-include/1/js/api/stats/render.js"],"sourcesContent":["import childProcess from 'child_process';\nimport pngquant from 'pngquant-bin';\nimport Promise from 'bluebird';\nimport phantom from 'phantom';\n\nexport default function (countries) {\n\treturn new Promise((resolve) => {\n\t\tphantom.create((ph) => {\n\t\t\tph.createPage((page) => {\n\t\t\t\tlet images = [];\n\n\t\t\t\tpage.set('onCallback', (image) => {\n\t\t\t\t\timages.push(image);\n\n\t\t\t\t\tif (images.length === countries.length) {\n\t\t\t\t\t\tph.exit();\n\n\t\t\t\t\t\timages.reduce((promise, image, index) => {\n\t\t\t\t\t\t\treturn promise.then(() => {\n\t\t\t\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\t\t\t\tchildProcess.execFile(pngquant, [ '-' ], { encoding: 'buffer' }, (error, stdout, stderr) => {\n\t\t\t\t\t\t\t\t\t\tif (error || stderr.length) {\n\t\t\t\t\t\t\t\t\t\t\treturn reject(error || stderr.toString());\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\timages[index] = stdout;\n\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t}).stdin.write(image.replace(/^data:image\\/png;base64,/, ''), 'base64');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, Promise.resolve()).then(() => {\n\t\t\t\t\t\t\tresolve(images);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tpage.set('content', `\n\t\t\t\t\t<html>\n\t\t\t\t\t\t<head>\n\t\t\t\t\t\t\t<script src=\"https://www.google.com/jsapi\"></script>\n\t\t\t\t\t\t\t<script>\n\t\t\t\t\t\t\t\tgoogle.load('visualization', '1.1', {\n\t\t\t\t\t\t\t\t\tpackages: [ 'corechart', 'geochart' ],\n\t\t\t\t\t\t\t\t\tlanguage: 'en',\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tgoogle.setOnLoadCallback(function () {\n\t\t\t\t\t\t\t\t\tvar countries = ${JSON.stringify(countries)};\n\n\t\t\t\t\t\t\t\t\tcountries.forEach(function (country) {\n\t\t\t\t\t\t\t\t\t\tcountry.forEach(function (entry) {\n\t\t\t\t\t\t\t\t\t\t\tentry[0] = new Date(entry[0] * 1000)\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcountries.forEach(function (country) {\n\t\t\t\t\t\t\t\t\t\tvar tooltipData = new google.visualization.DataTable();\n\t\t\t\t\t\t\t\t\t\tvar tooltipChart = new google.visualization.LineChart(document.getElementById('chart'));\n\n\t\t\t\t\t\t\t\t\t\ttooltipData.addColumn('date', 'Date');\n\t\t\t\t\t\t\t\t\t\ttooltipData.addColumn('number', 'Hits');\n\t\t\t\t\t\t\t\t\t\ttooltipData.addRows(country);\n\n\t\t\t\t\t\t\t\t\t\tgoogle.visualization.events.addListener(tooltipChart, 'ready', function () {\n\t\t\t\t\t\t\t\t\t\t\twindow.callPhantom(tooltipChart.getImageURI());\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\ttooltipChart.draw(tooltipData, {\n\t\t\t\t\t\t\t\t\t\t\tchartArea: {\n\t\t\t\t\t\t\t\t\t\t\t\tleft: 35,\n\t\t\t\t\t\t\t\t\t\t\t\ttop: 10,\n\t\t\t\t\t\t\t\t\t\t\t\theight: 100,\n\t\t\t\t\t\t\t\t\t\t\t\twidth: 270,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tbackgroundColor: {\n\t\t\t\t\t\t\t\t\t\t\t\tfill: 'transparent',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\twidth: 320,\n\t\t\t\t\t\t\t\t\t\t\theight: 130,\n\t\t\t\t\t\t\t\t\t\t\tcurveType: 'function',\n\t\t\t\t\t\t\t\t\t\t\tfontSize: 13,\n\t\t\t\t\t\t\t\t\t\t\tlegend: 'none',\n\t\t\t\t\t\t\t\t\t\t\tvAxis: {\n\t\t\t\t\t\t\t\t\t\t\t\tformat: 'short',\n\t\t\t\t\t\t\t\t\t\t\t\tgridlines: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor: '#363f49',\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\ttextStyle: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor: '#fff',\n\t\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 10,\n\t\t\t\t\t\t\t\t\t\t\t\t\tbold: false,\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\thAxis: {\n\t\t\t\t\t\t\t\t\t\t\t\tformat: 'MMM d',\n\t\t\t\t\t\t\t\t\t\t\t\tgridlines: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor: '#363f49',\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\ttextStyle: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor: '#fff',\n\t\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 10,\n\t\t\t\t\t\t\t\t\t\t\t\t\tbold: false,\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t</script>\n\t\t\t\t\t\t</head>\n\n\t\t\t\t\t\t<body>\n\t\t\t\t\t\t\t<div id=\"chart\"></div>\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>`);\n\t\t\t});\n\t\t});\n\t});\n}\n"],"names":[],"mappings":";;;;;;;;6BAAyB,eAAe;;;;2BACnB,cAAc;;;;wBACf,UAAU;;;;uBACV,SAAS;;;;qBAEd,UAAU,SAAS,EAAE;AACnC,QAAO,0BAAY,UAAC,OAAO,EAAK;AAC/B,uBAAQ,MAAM,CAAC,UAAC,EAAE,EAAK;AACtB,KAAE,CAAC,UAAU,CAAC,UAAC,IAAI,EAAK;AACvB,QAAI,MAAM,GAAG,EAAE,CAAC;;AAEhB,QAAI,CAAC,GAAG,CAAC,YAAY,EAAE,UAAC,KAAK,EAAK;AACjC,WAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;;AAEnB,SAAI,MAAM,CAAC,MAAM,KAAK,SAAS,CAAC,MAAM,EAAE;AACvC,QAAE,CAAC,IAAI,EAAE,CAAC;;AAEV,YAAM,CAAC,MAAM,CAAC,UAAC,OAAO,EAAE,KAAK,EAAE,KAAK,EAAK;AACxC,cAAO,OAAO,CAAC,IAAI,CAAC,YAAM;AACzB,eAAO,0BAAY,UAAC,OAAO,EAAE,MAAM,EAAK;AACvC,oCAAa,QAAQ,2BAAW,CAAE,GAAG,CAAE,EAAE,EAAE,QAAQ,EAAE,QAAQ,EAAE,EAAE,UAAC,KAAK,EAAE,MAAM,EAAE,MAAM,EAAK;AAC3F,cAAI,KAAK,IAAI,MAAM,CAAC,MAAM,EAAE;AAC3B,kBAAO,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;WAC1C;;AAED,gBAAM,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC;AACvB,iBAAO,EAAE,CAAC;UACV,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,0BAA0B,EAAE,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAC;SACxE,CAAC,CAAC;QACH,CAAC,CAAC;OACH,EAAE,sBAAQ,OAAO,EAAE,CAAC,CAAC,IAAI,CAAC,YAAM;AAChC,cAAO,CAAC,MAAM,CAAC,CAAC;OAChB,CAAC,CAAC;MACH;KACD,CAAC,CAAC;;AAEH,QAAI,CAAC,GAAG,CAAC,SAAS,0ZAWK,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,85EAkEtC,CAAC;IACX,CAAC,CAAC;GACH,CAAC,CAAC;EACH,CAAC,CAAC;CACH"}