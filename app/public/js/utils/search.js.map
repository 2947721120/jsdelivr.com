{"version":3,"file":"search.js","sources":["../src/public/js/utils/search.js"],"sourcesContent":["import algolia from './algolia.js';\nimport parseQuery from './parse-query.js';\n\nlet jsDelivrIndex = algolia.initIndex('jsDelivr');\n\nexport default function (queryString, page = 0, hitsPerPage = 10) {\n\treturn Promise.resolve().then(() => {\n\t\tlet parsed = parseQuery(queryString);\n\t\tlet options = { page, hitsPerPage };\n\t\tlet promise;\n\n\t\tif (parsed.facetFilters) {\n\t\t\toptions.facetFilters = parsed.facetFilters;\n\t\t}\n\n\t\tif (parsed.query || options.facetFilters) {\n\t\t\tpromise = jsDelivrIndex.search(parsed.query, options);\n\t\t} else {\n\t\t\tpromise = jsDelivrIndex.browse(options.page, hitsPerPage);\n\t\t}\n\n\t\treturn promise.then((response) => {\n\t\t\tlet load = [];\n\n\t\t\tresponse.hits.forEach((project) => {\n\t\t\t\tproject.selectedVersion = project.lastversion;\n\n\t\t\t\tif (!project.assets.length) {\n\t\t\t\t\tload.push(project);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!load.length) {\n\t\t\t\treturn {\n\t\t\t\t\tresponse: $.extend(true, {}, response),\n\t\t\t\t\tqueryString,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\talgolia.startQueriesBatch();\n\n\t\t\tload.forEach((project) => {\n\t\t\t\talgolia.addQueryInBatch('jsDelivr_assets', '', {\n\t\t\t\t\thitsPerPage: 100,\n\t\t\t\t\tfacetFilters: `name: ${project.name}`,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn algolia.sendQueriesBatch().then((content) => {\n\t\t\t\tload.forEach((project, index) => {\n\t\t\t\t\tproject.assets = content.results[index].hits;\n\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\tresponse: $.extend(true, {}, response),\n\t\t\t\t\tqueryString,\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t});\n}\n"],"names":[],"mappings":";;;;;;;;yBAAoB,cAAc;;;;4BACX,kBAAkB;;;;AAEzC,IAAI,aAAa,GAAG,uBAAQ,SAAS,CAAC,UAAU,CAAC,CAAC;;qBAEnC,UAAU,WAAW,EAA8B;KAA5B,IAAI,yDAAG,CAAC;KAAE,WAAW,yDAAG,EAAE;;AAC/D,QAAO,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,YAAM;AACnC,MAAI,MAAM,GAAG,+BAAW,WAAW,CAAC,CAAC;AACrC,MAAI,OAAO,GAAG,EAAE,IAAI,EAAJ,IAAI,EAAE,WAAW,EAAX,WAAW,EAAE,CAAC;AACpC,MAAI,OAAO,YAAA,CAAC;;AAEZ,MAAI,MAAM,CAAC,YAAY,EAAE;AACxB,UAAO,CAAC,YAAY,GAAG,MAAM,CAAC,YAAY,CAAC;GAC3C;;AAED,MAAI,MAAM,CAAC,KAAK,IAAI,OAAO,CAAC,YAAY,EAAE;AACzC,UAAO,GAAG,aAAa,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;GACtD,MAAM;AACN,UAAO,GAAG,aAAa,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;GAC1D;;AAED,SAAO,OAAO,CAAC,IAAI,CAAC,UAAC,QAAQ,EAAK;AACjC,OAAI,IAAI,GAAG,EAAE,CAAC;;AAEd,WAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,UAAC,OAAO,EAAK;AAClC,WAAO,CAAC,eAAe,GAAG,OAAO,CAAC,WAAW,CAAC;;AAE9C,QAAI,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE;AAC3B,SAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KACnB;IACD,CAAC,CAAC;;AAEH,OAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AACjB,WAAO;AACN,aAAQ,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE,EAAE,QAAQ,CAAC;AACtC,gBAAW,EAAX,WAAW;KACX,CAAC;IACF;;AAED,0BAAQ,iBAAiB,EAAE,CAAC;;AAE5B,OAAI,CAAC,OAAO,CAAC,UAAC,OAAO,EAAK;AACzB,2BAAQ,eAAe,CAAC,iBAAiB,EAAE,EAAE,EAAE;AAC9C,gBAAW,EAAE,GAAG;AAChB,iBAAY,aAAW,OAAO,CAAC,IAAI,AAAE;KACrC,CAAC,CAAC;IACH,CAAC,CAAC;;AAEH,UAAO,uBAAQ,gBAAgB,EAAE,CAAC,IAAI,CAAC,UAAC,OAAO,EAAK;AACnD,QAAI,CAAC,OAAO,CAAC,UAAC,OAAO,EAAE,KAAK,EAAK;AAChC,YAAO,CAAC,MAAM,GAAG,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC;KAC7C,CAAC,CAAC;;AAEH,WAAO;AACN,aAAQ,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE,EAAE,QAAQ,CAAC;AACtC,gBAAW,EAAX,WAAW;KACX,CAAC;IACF,CAAC,CAAC;GACH,CAAC,CAAC;EACH,CAAC,CAAC;CACH"}